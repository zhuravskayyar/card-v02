<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∫–∞—á–∫–∏ –∫–∞—Ä—Ç - –¢–µ—Å—Ç</title>
  <style>
    body {
      font-family: monospace;
      background: #0a0805;
      color: #f0e6d2;
      padding: 20px;
      white-space: pre-wrap;
    }
    .success { color: #a6ff7a; }
    .error { color: #ff4444; }
    .info { color: #f2d07a; }
  </style>
</head>
<body>
  <h1>üß™ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–∫–∞—á–∫–∏ –∫–∞—Ä—Ç</h1>
  
  <!-- Card System Scripts -->
  <script src="js/data/cards.js"></script>
  <script src="js/game/power.js"></script>
  <script src="js/data/cards_index.js"></script>

  <script>
    console.log('=== –¢–ï–°–¢ –°–ò–°–¢–ï–ú–ò –ü–†–û–ö–ê–ß–ö–ò ===\n');

    // Mock profile –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
    const testProfile = {
      name: "TestUser",
      level: 1,
      xp: 0,
      gold: 10,
      gems: 1500,
      wins: 0,
      losses: 0,
      gamesPlayed: 0,
      createdAt: Date.now(),
      deckCards: [
        { id: "C-F-001", level: 1 },
        { id: "C-W-001", level: 1 },
        { id: "C-A-001", level: 1 },
        { id: "C-E-001", level: 1 },
        { id: "C-F-002", level: 1 },
        { id: "C-W-002", level: 1 },
        { id: "C-A-002", level: 1 },
        { id: "C-E-002", level: 1 },
        { id: "C-F-003", level: 1 }
      ],
      collectionCards: [
        { id: "C-F-001", level: 1 }, // –¥—É–±–ª—ñ–∫–∞—Ç
        { id: "C-F-001", level: 1 }, // —â–µ –¥—É–±–ª—ñ–∫–∞—Ç
        { id: "C-W-001", level: 1 }, // –¥—É–±–ª—ñ–∫–∞—Ç
        { id: "C-A-002", level: 1 }, // –¥—É–±–ª—ñ–∫–∞—Ç
        { id: "C-A-002", level: 1 }, // —â–µ –¥—É–±–ª—ñ–∫–∞—Ç
        { id: "C-A-002", level: 1 }, // —â–µ –¥—É–±–ª—ñ–∫–∞—Ç
        { id: "C-F-004", level: 1 }  // –Ω–æ–≤–∞ –∫–∞—Ä—Ç–∞ –±–µ–∑ –¥—É–±–ª—ñ–∫–∞—Ç–∞ –≤ –¥–µ—Ü—ñ
      ]
    };

    // –Ü–º—ñ—Ç–∞—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ–π navigation
    const navigationMock = {
      getInventory(profile) {
        const inventory = {};
        [...profile.deckCards, ...profile.collectionCards].forEach(userCard => {
          inventory[userCard.id] = (inventory[userCard.id] || 0) + 1;
        });
        return inventory;
      },

      getExtraCopies(inventory, cardId) {
        const total = inventory[cardId] || 0;
        return Math.max(0, total - 1);
      },

      getUpgradeCost(level) {
        return level;
      },

      canUpgradeCard(deckItem, inventory) {
        const cost = this.getUpgradeCost(deckItem.level);
        const extra = this.getExtraCopies(inventory, deckItem.id);
        return extra >= cost;
      },

      hasAnyUpgradable(deck, inventory) {
        return deck.some(item => this.canUpgradeCard(item, inventory));
      },

      performUpgrade(deckItem, inventory, profile) {
        const cost = this.getUpgradeCost(deckItem.level);
        const extra = this.getExtraCopies(inventory, deckItem.id);

        if (extra < cost) return false;

        let toRemove = cost;
        for (let i = profile.collectionCards.length - 1; i >= 0 && toRemove > 0; i--) {
          if (profile.collectionCards[i].id === deckItem.id) {
            profile.collectionCards.splice(i, 1);
            toRemove--;
          }
        }

        deckItem.level += 1;
        return true;
      }
    };

    // –¢–µ—Å—Ç–∏
    function log(msg, type = 'info') {
      const span = document.createElement('span');
      span.className = type;
      span.textContent = msg + '\n';
      document.body.appendChild(span);
      console.log(msg);
    }

    function test(name, fn) {
      try {
        fn();
        log(`‚úì ${name}`, 'success');
      } catch (e) {
        log(`‚úó ${name}: ${e.message}`, 'error');
      }
    }

    // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤
    log('1. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è getInventory()', 'info');
    test('–ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î –≤—Å—ñ –∫–æ–ø—ñ—ó –∫–∞—Ä—Ç', () => {
      const inv = navigationMock.getInventory(testProfile);
      if (inv['C-F-001'] !== 3) throw new Error(`C-F-001 –º–∞–≤ –±—É—Ç–∏ 3, –∞–ª–µ ${inv['C-F-001']}`);
      if (inv['C-A-002'] !== 4) throw new Error(`C-A-002 –º–∞–≤ –±—É—Ç–∏ 4, –∞–ª–µ ${inv['C-A-002']}`);
    });

    log('\n2. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è getExtraCopies()', 'info');
    test('–†–∞—Ö—É—î –ª–∏—à–Ω—ñ –∫–æ–ø—ñ—ó –ø—Ä–∞–≤–∏–ª—å–Ω–æ', () => {
      const inv = navigationMock.getInventory(testProfile);
      const extra1 = navigationMock.getExtraCopies(inv, 'C-F-001');
      if (extra1 !== 2) throw new Error(`C-F-001: –º–∞–ª–æ –±—É—Ç–∏ 2, –∞–ª–µ ${extra1}`);
      const extra2 = navigationMock.getExtraCopies(inv, 'C-F-002');
      if (extra2 !== 0) throw new Error(`C-F-002: –º–∞–ª–æ –±—É—Ç–∏ 0, –∞–ª–µ ${extra2}`);
    });

    log('\n3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è getUpgradeCost()', 'info');
    test('–í–∞—Ä—Ç—ñ—Å—Ç—å –∑—Ä–æ—Å—Ç–∞—î –∑ —Ä—ñ–≤–Ω–µ–º', () => {
      if (navigationMock.getUpgradeCost(1) !== 1) throw new Error('lvl 1 –ø–æ–≤–∏–Ω–µ–Ω —Å—Ç–∞—Ç–∏ 1');
      if (navigationMock.getUpgradeCost(2) !== 2) throw new Error('lvl 2 –ø–æ–≤–∏–Ω–µ–Ω —Å—Ç–∞—Ç–∏ 2');
      if (navigationMock.getUpgradeCost(3) !== 3) throw new Error('lvl 3 –ø–æ–≤–∏–Ω–µ–Ω —Å—Ç–∞—Ç–∏ 3');
    });

    log('\n4. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è canUpgradeCard()', 'info');
    test('–ö–∞—Ä—Ç–∞ C-F-001 (3 –∫–æ–ø—ñ—ó) lvl 1 - –º–æ–∂–Ω–∞ –∞–ø–≥—Ä–µ–π–¥–∏—Ç–∏', () => {
      const inv = navigationMock.getInventory(testProfile);
      const card = testProfile.deckCards[0];
      if (!navigationMock.canUpgradeCard(card, inv)) throw new Error('–ü–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ true');
    });

    test('–ö–∞—Ä—Ç–∞ C-F-002 (1 –∫–æ–ø—ñ—è) lvl 1 - –Ω–µ –º–æ–∂–Ω–∞ –∞–ø–≥—Ä–µ–π–¥–∏—Ç–∏', () => {
      const inv = navigationMock.getInventory(testProfile);
      const card = testProfile.deckCards[4];
      if (navigationMock.canUpgradeCard(card, inv)) throw new Error('–ü–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ false');
    });

    log('\n5. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è hasAnyUpgradable()', 'info');
    test('–î–µ–∫–∞ –º–∞—î –∞–ø–≥—Ä–µ–π–¥–∂–≤–∞–ª—å–Ω—ñ –∫–∞—Ä—Ç–∏', () => {
      const inv = navigationMock.getInventory(testProfile);
      if (!navigationMock.hasAnyUpgradable(testProfile.deckCards, inv)) throw new Error('–ü–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ true');
    });

    log('\n6. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è performUpgrade()', 'info');
    test('–ê–ø–≥—Ä–µ–π–¥ –∫–∞—Ä—Ç–∏ –∑–º—ñ–Ω—é—î —Ä—ñ–≤–µ–Ω—å —ñ –≤–∏–¥–∞–ª—è—î –¥—É–±–ª—ñ–∫–∞—Ç–∏', () => {
      const inv = navigationMock.getInventory(testProfile);
      const card = testProfile.deckCards[0];
      const oldLevel = card.level;
      const oldCollectionCount = testProfile.collectionCards.length;
      
      const success = navigationMock.performUpgrade(card, inv, testProfile);
      
      if (!success) throw new Error('–ê–ø–≥—Ä–µ–π–¥ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ —É—Å–ø—ñ—à–Ω–∏–º');
      if (card.level !== oldLevel + 1) throw new Error('–†—ñ–≤–µ–Ω—å –Ω–µ –∑–º—ñ–Ω–∏–≤—Å—è');
      if (testProfile.collectionCards.length !== oldCollectionCount - 1) throw new Error('–î—É–±–ª—ñ–∫–∞—Ç –Ω–µ –≤–∏–¥–∞–ª–∏–≤—Å—è');
    });

    log('\n7. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –∞–ø–≥—Ä–µ–π–¥—É', 'info');
    test('–ú–Ω–æ–∂–∏–Ω–Ω—ñ –∞–ø–≥—Ä–µ–π–¥–∏ –∑—ñ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è–º –≤–∞—Ä—Ç–æ—Å—Ç—ñ', () => {
      const profile = JSON.parse(JSON.stringify(testProfile));
      const inv = navigationMock.getInventory(profile);
      const card = profile.deckCards[2]; // C-A-001 (4 –∫–æ–ø—ñ—ó)
      
      // –ü–µ—Ä—à–∏–π –∞–ø–≥—Ä–µ–π–¥ (–≤–∞—Ä—Ç—ñ—Å—Ç—å 1, —î 3 –ª–∏—à–Ω—ñ—Ö)
      navigationMock.performUpgrade(card, navigationMock.getInventory(profile), profile);
      if (card.level !== 2) throw new Error('–ü–µ—Ä—à–∏–π –∞–ø–≥—Ä–µ–π–¥ –Ω–µ –≤–¥–∞–≤—Å—è');
      
      // –î—Ä—É–≥–∏–π –∞–ø–≥—Ä–µ–π–¥ (–≤–∞—Ä—Ç—ñ—Å—Ç—å 2, —î 2 –ª–∏—à–Ω—ñ—Ö)
      const inv2 = navigationMock.getInventory(profile);
      navigationMock.performUpgrade(card, inv2, profile);
      if (card.level !== 3) throw new Error('–î—Ä—É–≥–∏–π –∞–ø–≥—Ä–µ–π–¥ –Ω–µ –≤–¥–∞–≤—Å—è');
      
      // –¢—Ä–µ—Ç—ñ–π –∞–ø–≥—Ä–µ–π–¥ (–≤–∞—Ä—Ç—ñ—Å—Ç—å 3, —î 1 –ª–∏—à–Ω—è) - –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –≤–¥–∞—Ç–∏—Å—å
      const inv3 = navigationMock.getInventory(profile);
      const success = navigationMock.performUpgrade(card, inv3, profile);
      if (success) throw new Error('–¢—Ä–µ—Ç—ñ–π –∞–ø–≥—Ä–µ–π–¥ –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –±—É–≤ –≤–¥–∞—Ç–∏—Å—å');
      if (card.level !== 3) throw new Error('–†—ñ–≤–µ–Ω—å –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –±—É–≤ –∑–º—ñ–Ω–∏—Ç–∏—Å—å');
    });

    log('\n8. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ–∫—Ä–µ–º–æ–≥–æ –≤–∏–ø–∞–¥–∫—É - –∫–∞—Ä—Ç–∞ –±–µ–∑ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤', 'info');
    test('–ö–∞—Ä—Ç–∞ F-002 (1 –∫–æ–ø—ñ—è –≤ –¥–µ—Ü—ñ) –Ω–µ –∞–ø–≥—Ä–µ–π–¥–∂—É—î—Ç—å—Å—è', () => {
      const inv = navigationMock.getInventory(testProfile);
      const card = testProfile.deckCards.find(c => c.id === 'C-F-002');
      const extra = navigationMock.getExtraCopies(inv, card.id);
      if (extra !== 0) throw new Error(`–ü–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ 0 –ª–∏—à–Ω—ñ—Ö, –∞–ª–µ ${extra}`);
      if (navigationMock.canUpgradeCard(card, inv)) throw new Error('–ö–∞—Ä—Ç–∞ –Ω–µ –ø–æ–≤–∏–Ω–Ω–∞ –∞–ø–≥—Ä–µ–π–¥–∂—É–≤–∞—Ç–∏—Å—å');
    });

    log('\n========== –í–°–Ü –¢–ï–°–¢–ò –ü–†–û–ô–î–ï–ù–Ü! ==========', 'success');
    log('\n–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∫–∞—á–∫–∏ –≥–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è! üöÄ', 'info');
  </script>
</body>
</html>
